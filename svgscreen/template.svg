{{- /*
Tries to generate SVG code comptible with browers and inkscape.
For some reason inkscape seems to not like CSS for rect fill etc that much
so currently using <use> instead.
*/ -}}
{{- /*
xml:space="preserve" is used to forces some svg readers (ex inkscape) to not collapse
whitespace only tspan:s preventing underline to be properly rendered.
*/ -}}
<svg width="{{$.TerminalWidth}}ch" height="{{$.NrLines}}em" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve">
    <style>
        {{- if gt (len $.FontEmbedded) 0}}
        @font-face {
            font-family: {{$.FontName}};
            src: url(data:;base64,{{- base64 $.FontEmbedded}});
        }
        {{- else if ne $.FontRef ""}}
        @font-face {
            font-family: {{$.FontName}};
            src: url({{$.FontRef}});
        }
        {{- end}}
        * {
            font-family: {{if $.FontName}}{{$.FontName}}, {{end}}monospace;
            font-size: {{$.FontSize}}px;
        }
        tspan, text {
            font-variant-ligatures: none;
            dominant-baseline: text-before-edge;
            alignment-baseline: text-before-edge;
            white-space: pre;{{/* draw underline even when whitespace */}}
            fill: {{$.ForegroundColor}};
        }
    </style>
{{- if not .Transparent}}
    <rect width="100%" height="100%" x="0" y="0" style="fill: {{$.BackgroundColor}}"/>
{{- end}}
{{- range $li, $l := .TextElements}}
<text x="0ch" y="{{$l.Y}}em">{{- range $si, $s := $l.TextSpans}}<tspan{{if ne $s.Style ""}} style="{{ $s.Style }}"{{end}}{{if ne $s.Decoration ""}} text-decoration="{{ $s.Decoration }}"{{end}}>{{$s.Content}}</tspan>{{- /* no new line */ -}}{{- end}}</text>
{{- end}}
</svg>
